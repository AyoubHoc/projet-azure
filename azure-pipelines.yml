trigger:
  branches:
    include:
      - main

pool:
  vmImage: ubuntu-latest

variables:
  - name: azureSubscription
    value: 'AzureSPN'
  - name: resourceGroup
    value: 'projet-azure-rg'
  - name: apiAppName
    value: 'projet-azure-api'
  - name: keyVaultName
    value: 'projet-azure-kv'

stages:
- stage: Deploy
  jobs:
  - deployment: DeployFullStack
    environment: 'production'
    strategy:
      runOnce:
        deploy:
          steps:
            - checkout: self
            - task: AzureCLI@2
              inputs:
                azureSubscription: 'SERVICE-CONNECTION-AZURE'
                scriptType: bash
                scriptLocation: inlineScript
                inlineScript: |
                  az staticwebapp upload \
                    --name $(swaName) \
                    --resource-group $(resourceGroup) \
                    --source ./frontend \
                    --api ./api \
                    --location "$(location)"
